<!DOCTYPE html>
<html>
<head>
  <title>VeilForms Key Generator</title>
  <style>
    body { font-family: system-ui, sans-serif; max-width: 800px; margin: 2rem auto; padding: 1rem; }
    pre { background: #f5f5f5; padding: 1rem; overflow-x: auto; font-size: 12px; }
    button { padding: 0.75rem 1.5rem; font-size: 1rem; cursor: pointer; }
    .warning { background: #fff3cd; padding: 1rem; border-radius: 4px; margin: 1rem 0; }
    h1 { color: #333; }
    .key-section { margin: 2rem 0; padding: 1rem; border: 1px solid #ddd; border-radius: 8px; }
    .key-section h3 { margin-top: 0; }
  </style>
</head>
<body>
  <h1>VeilForms Key Generator</h1>

  <p>Generate an RSA key pair for VeilForms encryption.</p>

  <button onclick="generateKeys()">Generate New Key Pair</button>

  <div class="warning">
    <strong>Important:</strong> Keep your private key secret! Only the public key should be embedded in your website.
  </div>

  <div id="output" style="display: none;">
    <div class="key-section">
      <h3>Public Key (embed in your website)</h3>
      <p>Add this to your VeilForms.init() call:</p>
      <pre id="public-key"></pre>
      <button onclick="copyKey('public-key')">Copy Public Key</button>
    </div>

    <div class="key-section">
      <h3>Private Key (keep secret - for decrypting submissions)</h3>
      <p>Store this securely. You'll need it to decrypt form submissions.</p>
      <pre id="private-key"></pre>
      <button onclick="copyKey('private-key')">Copy Private Key</button>
    </div>
  </div>

  <script>
    async function generateKeys() {
      try {
        // Generate RSA key pair
        const keyPair = await crypto.subtle.generateKey(
          {
            name: 'RSA-OAEP',
            modulusLength: 2048,
            publicExponent: new Uint8Array([1, 0, 1]),
            hash: 'SHA-256',
          },
          true,
          ['encrypt', 'decrypt']
        );

        // Export keys to JWK format
        const publicKey = await crypto.subtle.exportKey('jwk', keyPair.publicKey);
        const privateKey = await crypto.subtle.exportKey('jwk', keyPair.privateKey);

        // Display keys
        document.getElementById('public-key').textContent = JSON.stringify(publicKey, null, 2);
        document.getElementById('private-key').textContent = JSON.stringify(privateKey, null, 2);
        document.getElementById('output').style.display = 'block';

        console.log('Keys generated successfully!');
      } catch (error) {
        alert('Error generating keys: ' + error.message);
        console.error(error);
      }
    }

    function copyKey(elementId) {
      const text = document.getElementById(elementId).textContent;
      navigator.clipboard.writeText(text).then(() => {
        alert('Copied to clipboard!');
      });
    }
  </script>
</body>
</html>
